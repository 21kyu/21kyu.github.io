<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Basic ETCD" /><meta name="author" content="Wongyu Lee" /><meta property="og:locale" content="en" /><meta name="description" content="Highly Available Fully Replicated Strong consistency model Scalable watch mechanism Concurrency control primitives" /><meta property="og:description" content="Highly Available Fully Replicated Strong consistency model Scalable watch mechanism Concurrency control primitives" /><link rel="canonical" href="https://blog.wqlee.com/posts/basic-etcd/" /><meta property="og:url" content="https://blog.wqlee.com/posts/basic-etcd/" /><meta property="og:site_name" content="wq.lee" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-19T23:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Basic ETCD" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wongyu Lee","url":"https://github.com/21kyu"},"dateModified":"2022-04-02T01:15:03+09:00","datePublished":"2022-01-19T23:00:00+09:00","description":"Highly Available Fully Replicated Strong consistency model Scalable watch mechanism Concurrency control primitives","headline":"Basic ETCD","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.wqlee.com/posts/basic-etcd/"},"url":"https://blog.wqlee.com/posts/basic-etcd/"}</script><title>Basic ETCD | wq.lee</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="wq.lee"><meta name="application-name" content="wq.lee"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/avata.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">wq.lee</a></div><div class="site-subtitle font-italic">룰루랄라 즐거웁다 쿠버네티스</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/21kyu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/wq-lee" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['qoo','kakao.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Basic ETCD</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Basic ETCD</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/21kyu">Wongyu Lee</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1642600800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-01-19 </em> </span> <span> Updated <em class="timeago" data-ts="1648829703" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-02 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="900 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><ul><li>Highly Available<li>Fully Replicated<li>Strong consistency model<li>Scalable watch mechanism<li>Concurrency control primitives</ul><p>Distributed Key/Value store Distributed consensus is a fancy way to express the idea of getting more than one party to agree on something</p><ul><li>We use tools like Kubernetes because we want to build a fault tolerance system, which requires redundancy and multiple resources<li>Taking action on the system means that every manager entity in the system has to agree about the action</ul><h2 id="what-is-raft"><span class="mr-2">What is Raft</span><a href="#what-is-raft" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In a distributed model, that log entry can only “become truth” once the manager agree on the new value.</p><p>Consensus Datastore: RAFT Consensus Algorithm</p><ul><li>Raft is an algorithm to manage consensus-based systems (like container orchestrators)<li>It is designed to be easy to understand<li>It also has a cute logo</ul><p>Raft implements consensus by a leader approach. The cluster has one and only one elected leader which is fully responsible for managing log replication on the other servers of the cluster. It means that the leader can decide on new entries’ placement and establishment of data flow between it and the other servers without consulting other servers. A leader leads until it fails or disconnects, in which case a new leader is elected.</p><p><a href="http://thesecretlivesofdata.com/raft/">The Secret Lives of Data</a></p><h3 id="raft-is-used-in-a-lot-of-places"><span class="mr-2">Raft is used in a lot of places</span><a href="#raft-is-used-in-a-lot-of-places" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Orchestration systems typically use a key/value store backed by a consensus algorithm</p><ul><li>Kubernetes -&gt; etcd, and by extension, every system that uses etcd<li>Docker (swarm mode)<li>Nomad<li>Zookeeper uses Zookeeper Atomic Broadcast (ZAB), which is similar to Raft</ul><h4 id="raft-is-responsible-for"><span class="mr-2">Raft is responsible for</span><a href="#raft-is-responsible-for" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><dl><dt>Leader election<dd>Raft uses a randomized election timeout to ensure that split vote problems are resolved quickly. This should reduce the chance of a split vote because servers won’t become candidates at the same time: a single server will time out, win the election, then become leader and send heartbeat messages to other servers before any of the followers can become candidates. <a href="https://raft.github.io/raftscope/index.html">raftscope</a><dt>Log replication<dd>The leader is responsible for the log replication. It accepts client requests. Each client request consists of a command to be executed by the replicated state machines in the cluster. After being appended to the leader’s log as a new entry, each of the requests is forwarded to the followers as AppendEntries messages. In case of unavailability of the followers, the leader retries AppendEntries messages indefinitely, until the log entry is eventually stored by all of the followers. <a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying">logging-post</a><dt>Safety<dd>Election safety (<em>at most one leader can be elected in a given term.</em>), Leader append-only (<em>a leader can only append new entries to its logs (it can neither overwrite nor delete entries).</em>), Log matching (<em>if two logs contain an entry with the same index and term, then the logs are identical in all entries up through the given index.</em>), Leader completeness (<em>if a log entry is committed in a given term then it will be present in the logs of the leaders since this term</em>), State machine safety (<em>if a server has applied a particular log entry to its state machine, then no other server may apply a different command for the same log.</em>)</dl><h4 id="restore-from-a-backup"><span class="mr-2">Restore from a backup</span><a href="#restore-from-a-backup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>You have a backup, right? : Some tools manage this for you</p><p>Generally speaking:</p><ul><li>The log snapshots live in <code class="language-plaintext highlighter-rouge">/snap</code><li>The WAL lives in <code class="language-plaintext highlighter-rouge">/wal</code></ul><h3 id="quorum"><span class="mr-2">Quorum</span><a href="#quorum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>The minimum number of votes needed to perform an operation. Without quorum, your system can’t do work.</p><p>Quorum is satisfied with over 50% of agreement.</p>\[(N/2) + 1\]<div class="table-wrapper"><table><thead><tr><th>Managers<th>Quorum<th>Fault Tolerance<tbody><tr><td>1<td>1<td>0<tr><td>2<td>2<td>0<tr><td>3<td>2<td>1<tr><td>4<td>2<td>1<tr><td>5<td>3<td>2<tr><td>6<td>4<td>2<tr><td>7<td>4<td>3</table></div><h3 id="key-space"><span class="mr-2">Key Space</span><a href="#key-space" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">/prefix/K8S type/namespace/resource name</code></p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/registry/pods/production/service1-xxxxxxxx
/registry/replicasets/development/service1
</pre></table></code></div></div><p><em>lexically ordered</em></p><h3 id="requestresponse-operations"><span class="mr-2">Request/Response Operations</span><a href="#requestresponse-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>RANGE &lt;start_key&gt;..&lt;end_key&gt;
PUT &lt;key&gt; &lt;value&gt;
DELETE RANGE &lt;start_key&gt;..&lt;end_key&gt;
TXN <span class="o">(</span><span class="k">if</span> &lt;condition&gt; <span class="k">then</span> &lt;op1, ..&gt; <span class="k">else</span> &lt;op2, ..&gt;<span class="o">)</span>
</pre></table></code></div></div><p><em>Linearizable Consistency (a.k.a External Consistency)</em></p><h3 id="streaming-operations"><span class="mr-2">Streaming Operations</span><a href="#streaming-operations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>CREATE WATCH &lt;key1&gt;..&lt;key2&gt;
client <span class="nt">-------------------------------------------</span><span class="o">&gt;</span> etcd
                gRPC bidirectional stream
client &lt;<span class="nt">-------------------------------------------</span> etcd
WATCH CREATED &lt;watch-id&gt;
EVENT &lt;watch-id&gt; PUT &lt;key1&gt; &lt;value1&gt;
EVENT &lt;watch-id&gt; DELETE &lt;key2&gt;
...
</pre></table></code></div></div><p>Eventual Consistency</p><p>client <Cache> &lt;---- Watch stream &lt;---- Follower &lt;--RAFT Chatter--&gt; Leader</Cache></p><h3 id="data-storage"><span class="mr-2">Data Storage</span><a href="#data-storage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Multi-version concurrency control / Copy-on-write for all modifications</p><p>etcd - MVCC keyspace. Values may be accessed by key+version. This is used to implement the watch operation.</p><p>Compaction applies to the etcd keyspace</p><ul><li>Removes all versions of objects older than a specific revision number.<li>Kubernetes default policy: all data older than 5 minutes every 5 minutes<li>Kube-apiserver requests compactions. etcd auto-compaction is disabled.</ul><p>BoltDB - MVCC internally enable 1 write + N reads to be executed concurrently.</p><p>Defragmentation applies to the bolt db file</p><ul><li>Recovers all free space in the bolt db file.<li>Only to shrink a db file as bolt does not automatically shrinks it`s file.<li>Etcd will defrag and the file only if requested. This is a “stop-the-world” operation.</ul><h3 id="how-etcd-stores-and-serves-data"><span class="mr-2">How etcd Stores and Serves Data</span><a href="#how-etcd-stores-and-serves-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>For each write:</p><ol><li>Append write to WAL (Write Ahead Log (.wal files)<li>Apply write to Keyspace (Persisted Keyspace (db file)</ol><p>Every “–snapshot-count” writes:</p><ul><li>Create a snapshot file<li>Record revision snapshot was created to WAL<li>Remove WAL file older than the snapshot</ul><p>RAFT ensures WAL log is the same on all members of an etcd cluster!</p><hr /><p><strong>References</strong></p><ol><li><a href="https://www.youtube.com/watch?v=NVMZBBQ9hsM">Debugging etcd - Joe Betz &amp; Jingyi Hu, Google - Youtube</a><li><a href="https://www.youtube.com/watch?v=n9VKAKwBj_0">Understanding Distributed Consensus in etcd and Kubernetes - Laura Frank, CloudBees - Youtube</a><li><a href="https://raft.github.io">The Raft Consensus Algorithm - Github</a><li><a href="https://en.wikipedia.org/wiki/Raft_(algorithm)">Raft (algorithm) - Wikipedia</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/etcd/'>etcd</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/watch/" class="post-tag no-text-decoration" >watch</a> <a href="/tags/event/" class="post-tag no-text-decoration" >event</a> <a href="/tags/etcd/" class="post-tag no-text-decoration" >etcd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Basic+ETCD+-+wq.lee&url=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fbasic-etcd%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Basic+ETCD+-+wq.lee&u=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fbasic-etcd%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fbasic-etcd%2F&text=Basic+ETCD+-+wq.lee" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fbasic-etcd%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/cgroups-and-kubernetes/">Control groups & Kubernetes</a><li><a href="/posts/what-is-a-kubernetes-watch-event-4rd/">Event란건 어쩌면 어려운게 아닐까</a><li><a href="/posts/scheduling-in-go-01/">Scheduling In Go I - OS Scheduler</a><li><a href="/posts/what-is-a-kubernetes-watch-event-3rd/">Informer의 구조</a><li><a href="/posts/what-is-a-kubernetes-watch-event-2nd/">Watch Server에 요청이 도달하기까지의 과정</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/event/">event</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/watch/">watch</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/apiserver/">apiserver</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/gorestful/">gorestful</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/scheduler/">scheduler</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/what-is-a-kubernetes-watch-event-3rd/"><div class="card-body"> <em class="timeago small" data-ts="1641649500" > 2022-01-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Informer의 구조</h3><div class="text-muted small"><p> 일전에 정리했던 내용과 같이 클라이언트가 API server에 Watch event를 요청할 때 streaming HTTP connection을 맺어 해당 리소스의 변경에 대한 이벤트를 전달받곤 했다. 이러한 변경 감지가 필요할 때마다 API server에 접근해야하는건 Kubernetes 시스템에 부하를 줄 수도 있다. 게다가 여러 클라이언트, 컨트...</p></div></div></a></div><div class="card"> <a href="/posts/what-is-a-kubernetes-watch-event-4rd/"><div class="card-body"> <em class="timeago small" data-ts="1643454000" > 2022-01-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Event란건 어쩌면 어려운게 아닐까</h3><div class="text-muted small"><p> Kubernetes Architecture Kubernetes는 microservice 기반의 아키텍처가 적용되어 있다. Control Plane, Worker Node의 컴포넌트들은 개별 서비스로 구현된다. 특히 Control Plane은 Event와 함께 느슨하게 결합된 구성 요소의 원칙을 많이 접목시켜 사용하고 있다. 이러한 아키텍처의 주요 이...</p></div></div></a></div><div class="card"> <a href="/posts/what-is-a-kubernetes-watch-event/"><div class="card-body"> <em class="timeago small" data-ts="1640502000" > 2021-12-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kubernetes의 Watch event는 어떻게 동작하는가</h3><div class="text-muted small"><p> Kubernetes는 pods, deployments, services와 같은 resource들을 모니터링하고 관련 event를 추적할 수 있는 Watch 개념을 가지고 있다. 대부분 이미 Kubernetes의 Watch 기능을 사용해봤을 것이다. 나는 Deployment 등을 배포하고 Pod의 배포 상태를 계속 보고 싶을 때 Kubectl에 -w ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/what-is-a-kubernetes-watch-event-3rd/" class="btn btn-outline-primary" prompt="Older"><p>Informer의 구조</p></a> <a href="/posts/what-is-a-kubernetes-watch-event-4rd/" class="btn btn-outline-primary" prompt="Newer"><p>Event란건 어쩌면 어려운게 아닐까</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://www.linkedin.com/in/wq-lee">Wongyu Lee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/event/">event</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/watch/">watch</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/apiserver/">apiserver</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/gorestful/">gorestful</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/scheduler/">scheduler</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4PS0JXVL1J"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4PS0JXVL1J'); }); </script>
