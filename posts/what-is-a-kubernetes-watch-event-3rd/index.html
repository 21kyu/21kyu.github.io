<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Informerì˜ êµ¬ì¡°" /><meta name="author" content="Wongyu Lee" /><meta property="og:locale" content="en" /><meta name="description" content="ì¼ì „ì— ì •ë¦¬í–ˆë˜ ë‚´ìš©ê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ê°€ API serverì— Watch eventë¥¼ ìš”ì²­í•  ë•Œ streaming HTTP connectionì„ ë§ºì–´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ê³¤ í–ˆë‹¤. ì´ëŸ¬í•œ ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ API serverì— ì ‘ê·¼í•´ì•¼í•˜ëŠ”ê±´ Kubernetes ì‹œìŠ¤í…œì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ë„ ìˆë‹¤. ê²Œë‹¤ê°€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Watch eventë¥¼ ìš”ì²­í•˜ê²Œ ë˜ë©´ ì‹œìŠ¤í…œì— ë”ìš± ë†’ì€ ë¶€í•˜ê°€ ìƒì„±ë  ê²ƒì´ë‹¤." /><meta property="og:description" content="ì¼ì „ì— ì •ë¦¬í–ˆë˜ ë‚´ìš©ê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ê°€ API serverì— Watch eventë¥¼ ìš”ì²­í•  ë•Œ streaming HTTP connectionì„ ë§ºì–´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ê³¤ í–ˆë‹¤. ì´ëŸ¬í•œ ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ API serverì— ì ‘ê·¼í•´ì•¼í•˜ëŠ”ê±´ Kubernetes ì‹œìŠ¤í…œì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ë„ ìˆë‹¤. ê²Œë‹¤ê°€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Watch eventë¥¼ ìš”ì²­í•˜ê²Œ ë˜ë©´ ì‹œìŠ¤í…œì— ë”ìš± ë†’ì€ ë¶€í•˜ê°€ ìƒì„±ë  ê²ƒì´ë‹¤." /><link rel="canonical" href="https://blog.wqlee.com/posts/what-is-a-kubernetes-watch-event-3rd/" /><meta property="og:url" content="https://blog.wqlee.com/posts/what-is-a-kubernetes-watch-event-3rd/" /><meta property="og:site_name" content="wq.lee" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-08T22:45:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Informerì˜ êµ¬ì¡°" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wongyu Lee","url":"https://github.com/21kyu"},"dateModified":"2022-04-12T14:31:27+09:00","datePublished":"2022-01-08T22:45:00+09:00","description":"ì¼ì „ì— ì •ë¦¬í–ˆë˜ ë‚´ìš©ê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ê°€ API serverì— Watch eventë¥¼ ìš”ì²­í•  ë•Œ streaming HTTP connectionì„ ë§ºì–´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ê³¤ í–ˆë‹¤. ì´ëŸ¬í•œ ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ API serverì— ì ‘ê·¼í•´ì•¼í•˜ëŠ”ê±´ Kubernetes ì‹œìŠ¤í…œì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ë„ ìˆë‹¤. ê²Œë‹¤ê°€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Watch eventë¥¼ ìš”ì²­í•˜ê²Œ ë˜ë©´ ì‹œìŠ¤í…œì— ë”ìš± ë†’ì€ ë¶€í•˜ê°€ ìƒì„±ë  ê²ƒì´ë‹¤.","headline":"Informerì˜ êµ¬ì¡°","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.wqlee.com/posts/what-is-a-kubernetes-watch-event-3rd/"},"url":"https://blog.wqlee.com/posts/what-is-a-kubernetes-watch-event-3rd/"}</script><title>Informerì˜ êµ¬ì¡° | wq.lee</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="wq.lee"><meta name="application-name" content="wq.lee"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/avata.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">wq.lee</a></div><div class="site-subtitle font-italic">ë£°ë£¨ë„ë¼ ì¦ê±°ì›ë‹¤ ì¿ ë²„ë„¤í‹°ìŠ¤</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/21kyu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/wq-lee" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['qoo','kakao.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Informerì˜ êµ¬ì¡°</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Informerì˜ êµ¬ì¡°</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/21kyu">Wongyu Lee</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1641649500" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-01-08 </em> </span> <span> Updated <em class="timeago" data-ts="1649741487" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-12 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3212 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><p>ì¼ì „ì— ì •ë¦¬í–ˆë˜ ë‚´ìš©ê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ê°€ API serverì— Watch eventë¥¼ ìš”ì²­í•  ë•Œ streaming HTTP connectionì„ ë§ºì–´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ê³¤ í–ˆë‹¤. ì´ëŸ¬í•œ ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ API serverì— ì ‘ê·¼í•´ì•¼í•˜ëŠ”ê±´ Kubernetes ì‹œìŠ¤í…œì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ë„ ìˆë‹¤. ê²Œë‹¤ê°€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Watch eventë¥¼ ìš”ì²­í•˜ê²Œ ë˜ë©´ ì‹œìŠ¤í…œì— ë”ìš± ë†’ì€ ë¶€í•˜ê°€ ìƒì„±ë  ê²ƒì´ë‹¤.</p><p>InformerëŠ” In-memory ìºì‹±ì„ í†µí•´ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì í–ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” Informerì— ëŒ€í•´ ì •ë¦¬í•´ë³´ë„ë¡ í•˜ì.</p><h3 id="prerequisites"><span class="mr-2">Prerequisites</span><a href="#prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li><a href="https://go.dev">Go</a><li><a href="https://kubernetes.io/docs/tasks/tools/#kubectl">kubectl</a><li><a href="https://minikube.sigs.k8s.io/docs/">minikube</a></ul><h2 id="first-lets-use-informer"><span class="mr-2">First, letâ€™s use Informer</span><a href="#first-lets-use-informer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Informerì— ëŒ€í•´ ìì„¸íˆ íŒŒì•…í•˜ê¸° ì „ì— ê°„ë‹¨íˆ ì‚¬ìš©í•´ë³´ê³ ì í•œë‹¤. ë¨¼ì € minikubeë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ì.</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>â¯ minikube start
ğŸ˜„  minikube v1.24.0 on Darwin 12.2
âœ¨  Automatically selected the docker driver. Other choices: hyperkit, parallels, ssh
ğŸ‘  Starting control plane node minikube <span class="k">in </span>cluster minikube
ğŸšœ  Pulling base image ...
ğŸ’¾  Downloading Kubernetes v1.22.3 preload ...
    <span class="o">&gt;</span> preloaded-images-k8s-v13-v1...: 501.73 MiB / 501.73 MiB  100.00% 55.37 Mi
    <span class="o">&gt;</span> gcr.io/k8s-minikube/kicbase: 355.78 MiB / 355.78 MiB  100.00% 14.47 MiB p
ğŸ”¥  Creating docker container <span class="o">(</span><span class="nv">CPUs</span><span class="o">=</span>2, <span class="nv">Memory</span><span class="o">=</span>1985MB<span class="o">)</span> ...
ğŸ³  Preparing Kubernetes v1.22.3 on Docker 20.10.8 ...
    â–ª Generating certificates and keys ...
    â–ª Booting up control plane ...
    â–ª Configuring RBAC rules ...
ğŸ”  Verifying Kubernetes components...
    â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
ğŸŒŸ  Enabled addons: storage-provisioner, default-storageclass
ğŸ„  Done! kubectl is now configured to use <span class="s2">"minikube"</span> cluster and <span class="s2">"default"</span> namespace by default
</pre></table></code></div></div><p>Informer ì˜ˆì œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•œ Go í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì¤€ë‹¤.</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>â¯ go mod init example.com/informer
go: creating new go.mod: module example.com/informer

â¯ <span class="nb">touch </span>main.go
</pre></table></code></div></div><p><strong>main.go</strong> íŒŒì¼ ìƒì„± í›„ ì•„ë˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ë„ë¡ í•˜ì.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
  <span class="s">"fmt"</span>
  <span class="s">"os"</span>
  <span class="s">"time"</span>

  <span class="n">v1</span> <span class="s">"k8s.io/api/core/v1"</span>
  <span class="s">"k8s.io/client-go/informers"</span>
  <span class="s">"k8s.io/client-go/kubernetes"</span>
  <span class="s">"k8s.io/client-go/tools/cache"</span>
  <span class="s">"k8s.io/client-go/tools/clientcmd"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">kubeconfigPath</span> <span class="o">:=</span> <span class="s">"location to your kubeconfig file path"</span>
  <span class="n">config</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">clientcmd</span><span class="o">.</span><span class="n">BuildConfigFromFlags</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="n">kubeconfigPath</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"The kubeconfig can't be loaded: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">())</span>
    <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">clientset</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">kubernetes</span><span class="o">.</span><span class="n">NewForConfig</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"NewForConfig failed: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">())</span>
    <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">stopCh</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="k">struct</span><span class="p">{})</span>
  <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">stopCh</span><span class="p">)</span>

  <span class="n">informerFactory</span> <span class="o">:=</span> <span class="n">informers</span><span class="o">.</span><span class="n">NewSharedInformerFactory</span><span class="p">(</span><span class="n">clientset</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">1</span><span class="p">)</span>

  <span class="n">podInformer</span> <span class="o">:=</span> <span class="n">informerFactory</span><span class="o">.</span><span class="n">Core</span><span class="p">()</span><span class="o">.</span><span class="n">V1</span><span class="p">()</span><span class="o">.</span><span class="n">Pods</span><span class="p">()</span>
  <span class="n">podInformer</span><span class="o">.</span><span class="n">Informer</span><span class="p">()</span><span class="o">.</span><span class="n">AddEventHandler</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">ResourceEventHandlerFuncs</span><span class="p">{</span>
    <span class="n">AddFunc</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">obj</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
      <span class="n">pod</span> <span class="o">:=</span> <span class="n">obj</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">v1</span><span class="o">.</span><span class="n">Pod</span><span class="p">)</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Add: "</span> <span class="o">+</span> <span class="n">pod</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">UpdateFunc</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">oldObj</span><span class="p">,</span> <span class="n">newObj</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
      <span class="n">pod</span> <span class="o">:=</span> <span class="n">newObj</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">v1</span><span class="o">.</span><span class="n">Pod</span><span class="p">)</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Update: "</span> <span class="o">+</span> <span class="n">pod</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">DeleteFunc</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">obj</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
      <span class="n">pod</span> <span class="o">:=</span> <span class="n">obj</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">v1</span><span class="o">.</span><span class="n">Pod</span><span class="p">)</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Delete: "</span> <span class="o">+</span> <span class="n">pod</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
    <span class="p">},</span>
  <span class="p">})</span>

  <span class="n">informerFactory</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">stopCh</span><span class="p">)</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"InformerFactory started"</span><span class="p">)</span>

  <span class="o">&lt;-</span><span class="n">stopCh</span>
<span class="p">}</span>
</pre></table></code></div></div><p>InformerFactoryë¡œë¶€í„° PodInformerë¥¼ ê°€ì ¸ì™€ì„œ ë³€ê²½ ê°ì§€ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ê¸°ë³¸ì ì´ê³  ê°„ë‹¨í•œ ì½”ë“œë¼ê³  í•  ìˆ˜ ìˆê² ë‹¤. <code class="language-plaintext highlighter-rouge">main()</code> í•¨ìˆ˜ë¥¼ í•˜ë‚˜í•˜ë‚˜ ì‚´í´ë³´ë„ë¡ í•˜ì.</p><p>16-20 ë¼ì¸ì€ <code class="language-plaintext highlighter-rouge">*rest.Config</code>ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ì´ë‹¤. Kubernetes API serverì— ëŒ€í•œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤. ê°ìì˜ ë¡œì»¬ì— ìˆëŠ” <strong>.kube/config</strong> íŒŒì¼ì„ í†µí•´ ë¹Œë“œë¥¼ í•˜ëŠ”ë° í•œê°€ì§€ ì°¸ê³ í•  ë¶€ë¶„ì€ <code class="language-plaintext highlighter-rouge">kubeconfigPath</code>ë¡œ <strong>~/.kube/config</strong> ë“±ì˜ ìƒëŒ€ ê²½ë¡œê°€ ì•„ë‹Œ ì ˆëŒ€ ê²½ë¡œë¡œ ì…ë ¥í•´ ì£¼ì–´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤.</p><p>23-27 ë¼ì¸ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">*rest.Config</code>ë¥¼ í†µí•´ <code class="language-plaintext highlighter-rouge">*kubernetes.Clientset</code>ì„ ìƒì„±í•˜ê³  ìˆë‹¤. ëª¨ë“  ê¸°ë³¸ Kubernetes ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë§ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì—¬ê¸°ì— í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— Clientsetë¼ê³  í•œë‹¤.</p><p>32 ë¼ì¸ì—ì„œ <a href="https://pkg.go.dev/k8s.io/client-go/informers@v0.23.1#SharedInformerFactory">SharedInformerFactory</a> ë¥¼ ë§Œë“ ë‹¤. Shared informer factoryëŠ” informerë“¤ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ì˜ ë³€ê²½ ì‚¬í•­ì„ ê³µìœ í•  ìˆ˜ ìˆê²Œ í•œë‹¤. ì¦‰, ì„œë¡œ ë‹¤ë¥¸ ì œì–´ ë£¨í”„ì—ì„œ Shared informer factoryë¥¼ í†µí•´ API serverì— ëŒ€í•œ ë™ì¼í•œ watch ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ë§ì´ë‹¤. ì´ëŸ¬í•œ íŠ¹ì„±ìœ¼ë¡œ ì¸í•´ì„œ kube-controller-manager ë‚´ë¶€ì— ìˆëŠ” ìˆ˜ë§ì€ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ì ‘ê·¼ì„ ê°ì í•˜ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ ë‚´ì— ì¡´ì¬í•˜ëŠ” ë‹¨ì¼ informerë¥¼ í†µí•´ ë¦¬ì†ŒìŠ¤ ë³€ê²½ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ê²Œ ëœë‹¤.</p><p>ì´ í›„ Pod informerë¥¼ ê°€ì ¸ì™€ì„œ <code class="language-plaintext highlighter-rouge">cache.ResourceEventHandlerFuncs</code>ë¥¼ ì‚¬ìš©í•´ <a href="https://pkg.go.dev/k8s.io/client-go/tools/cache@v0.23.1#ResourceEventHandler">ResourceEventHandler</a> ë¥¼ ë‹¬ì•„ì¤€ë‹¤. ResourceEventHandlerë¥¼ í†µí•´ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì—ì„œ ë°œìƒë˜ëŠ” ì´ë²¤íŠ¸ì— ëŒ€í•œ ì•Œë¦¼ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. í•œ ê°€ì§€ ëª…ì‹¬í•´ì•¼í•  ì‚¬ì•ˆì€ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì—ì„œ ìˆ˜ì‹ ëœ ê°ì²´ë¥¼ ì§ì ‘ ìˆ˜ì •í•´ì„œëŠ” ì•ˆëœë‹¤.</p><dl><dt>OnAdd<dd>Objectê°€ ì¶”ê°€ë  ë•Œ í˜¸ì¶œëœë‹¤.<dt>OnUpdate<dd>Objectê°€ ìˆ˜ì •ë  ë•Œ í˜¸ì¶œëœë‹¤. oldObjëŠ” objectì˜ ë³€ê²½ì— ë”°ë¥¸ ì´ë²¤íŠ¸ë¥¼ ë°›ê¸° ì „ì— ë§ˆì§€ë§‰ìœ¼ë¡œ ê´€ì°°ëœ ìƒíƒœì´ë‹¤. ì—¬ëŸ¬ ë³€ê²½ ì‚¬í•­ì´ ê²°í•©ë˜ì–´ ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ê²ƒì„ ë‹¨ì¼ ë³€ê²½ ì‚¬í•­ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¼ ë³¼ ìˆœ ì—†ë‹¤.<dt>OnDelete<dd>Objectê°€ ì‚­ì œë˜ê¸° ì „ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê³  ê·¸ë ‡ì§€ ëª»í•œë‹¤ë©´ DeletedFinalStateUnknown ìœ í˜•ì˜ objectë¥¼ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤. í›„ìì˜ ê²½ìš°ëŠ” watch eventê°€ ì–´ë– í•œ ë¬¸ì œë¡œ ì¸í•´ ì¢…ë£Œë˜ì–´ ì‚­ì œì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ë†“ì³¤ì„ ê²½ìš°ì— ë°œìƒë  ìˆ˜ ìˆë‹¤.</dl><p>ìœ„ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì²˜ë¦¬ ë¡œì§ì„ ì‘ì„±í•˜ë©´ ëœë‹¤. ì—¬ê¸°ì—ì„  ê°„ë‹¨íˆ ë¡œê¹…ë§Œ í•˜ëŠ” ì •ë„ë¡œ í•´ë‘ì—ˆë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ 53 ë¼ì¸ì—ì„œ stop channelì´ ë‹«í ë•Œê¹Œì§€ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ìœ ì§€ë  ìˆ˜ ìˆë„ë¡ ì±„ë„ ìˆ˜ì‹ ì„ ë°›ê²Œ í•´ë‘ì—ˆë‹¤. ì´ì œ ë°”ë¡œ ì‹¤í–‰í•´ë³´ì.</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>â¯ go mod tidy

â¯ go run main.go
InformerFactory started
Add: kube-apiserver-minikube
Add: storage-provisioner
Add: coredns-78fcd69978-424p5
Add: kube-proxy-crjsd
Add: etcd-minikube
Add: kube-scheduler-minikube
Add: kube-controller-manager-minikube
Update: kube-apiserver-minikube
Update: storage-provisioner
Update: coredns-78fcd69978-424p5
Update: kube-proxy-crjsd
Update: etcd-minikube
...
</pre></table></code></div></div><p>Kubernetes í´ëŸ¬ìŠ¤í„° ìœ„ì— ì˜¬ë¼ê°€ ìˆëŠ” ëª¨ë“  Podë“¤ì˜ ì´ë²¤íŠ¸ê°€ í•¸ë“¤ë§ë˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ëª¨ë“  namespaceì˜ podë¥¼ ê´€ì°°í•  í•„ìš”ëŠ” ì—†ìœ¼ë¯€ë¡œ ê´€ì°° ë²”ìœ„ë¥¼ ì¤„ì—¬ë³´ì.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">namespaceOption</span> <span class="o">:=</span> <span class="n">informers</span><span class="o">.</span><span class="n">WithNamespace</span><span class="p">(</span><span class="s">"default"</span><span class="p">)</span>
<span class="n">informerFactory</span> <span class="o">:=</span> <span class="n">informers</span><span class="o">.</span><span class="n">NewSharedInformerFactoryWithOptions</span><span class="p">(</span><span class="n">clientset</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">*</span><span class="m">1</span><span class="p">,</span> <span class="n">namespaceOption</span><span class="p">)</span>
</pre></table></code></div></div><p>32 ë¼ì¸ì˜ informerFactoryë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì„ ìœ„ì™€ ê°™ì´ ë³€ê²½í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ì.</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>â¯ go run main.go
InformerFactory started

<span class="c"># í•œì¸µ ì¡°ìš©í•´ì¡Œë‹¤. ìƒˆë¡œìš´ shellì„ ì—´ì–´ nginx podë¥¼ default namespaceì— ë°°í¬í•´ë³´ì.</span>
â¯ kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx
pod/nginx created

<span class="c"># ì´ì œ ë‹¤ì‹œ ì´ì „ shellë¡œ ëŒì•„ê°€ë³´ë©´</span>
Add: nginx
Update: nginx
Update: nginx
Update: nginx
Update: nginx
Update: nginx
...
</pre></table></code></div></div><p>nginx podì— ëŒ€í•œ ì´ë²¤íŠ¸ê°€ í•¸ë“¤ë§ë˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ ì´ìƒí•œ ë¶€ë¶„ì´ ìˆë‹¤. OnUpdate ì´ë²¤íŠ¸ëŠ” ì™œ ê³„ì† ë¶ˆë ¤ì§€ê³  ìˆì„ê¹Œ?</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="k">func</span><span class="p">(</span><span class="n">obj</span> <span class="k">interface</span><span class="p">{})</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="c">// from oldest to newest</span>
  <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">obj</span><span class="o">.</span><span class="p">(</span><span class="n">Deltas</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">obj</span> <span class="o">:=</span> <span class="n">d</span><span class="o">.</span><span class="n">Object</span>
    <span class="k">if</span> <span class="n">transformer</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="k">var</span> <span class="n">err</span> <span class="kt">error</span>
      <span class="n">obj</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">switch</span> <span class="n">d</span><span class="o">.</span><span class="n">Type</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">Sync</span><span class="p">,</span> <span class="n">Replaced</span><span class="p">,</span> <span class="n">Added</span><span class="p">,</span> <span class="n">Updated</span><span class="o">:</span>
      <span class="k">if</span> <span class="n">old</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">clientState</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="n">exists</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">clientState</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">err</span>
        <span class="p">}</span>
        <span class="n">h</span><span class="o">.</span><span class="n">OnUpdate</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">clientState</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">err</span>
        <span class="p">}</span>
        <span class="n">h</span><span class="o">.</span><span class="n">OnAdd</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="k">case</span> <span class="n">Deleted</span><span class="o">:</span>
      <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">clientState</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
      <span class="p">}</span>
      <span class="n">h</span><span class="o">.</span><span class="n">OnDelete</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Informerì—ì„œëŠ” <a href="https://pkg.go.dev/k8s.io/client-go/tools/cache#DeltaFIFO">DeltaFIFO</a> ì—ì„œ deltaë¥¼ êº¼ë‚´ì™€ ìœ„ì™€ ê°™ì€ ì²˜ë¦¬ë¥¼ í•˜ê²Œ ëœë‹¤. 13 ë¼ì¸ë¶€í„°ì˜ switch ë¬¸ì„ ë³´ê²Œ ë˜ë©´ Updated íƒ€ì… ë¿ë§Œ ì•„ë‹ˆë¼ Sync, Replacedì™€ ê°™ì€ ë‹¤ë¥¸ íƒ€ì… ë˜í•œ <code class="language-plaintext highlighter-rouge">h.OnUpdate()</code>ë¡œ í˜¸ì¶œë  ìˆ˜ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p><p>Sync íƒ€ì…ì€ informerFactoryë¥¼ ìƒì„±í•  ë•Œ <code class="language-plaintext highlighter-rouge">defaultResync</code> ì¸ìë¡œ ë„˜ê²¨ì¤€ time.Durationê³¼ ë°€ì ‘í•œ ì—°ê´€ì´ ìˆë‹¤. ì£¼ê¸°ì ìœ¼ë¡œ ì¬ë™ê¸°í™”ê°€ ë˜ë©° ì´ ê¸°ê°„ë™ì•ˆ í•©ì„±ëœ ì´ë²¤íŠ¸ê°€ í•¸ë“¤ëŸ¬ë¡œ ì „ë‹¬ë˜ê²Œ ëœë‹¤. ìœ„ ì‘ì„±ëœ ì½”ë“œì— ë”°ë¥´ë©´ 1ì´ˆë§ˆë‹¤ resyncë¥¼ í•œë‹¤. 5ì´ˆë¡œ ë³€ê²½í•´ë³´ê³  ì–¼ë§ˆë‚˜ ìì£¼ ë¶ˆë¦¬ëŠ”ì§€ í™•ì¸í•´ë³´ì.</p><p>Replaced íƒ€ì…ì€ watch eventì˜ ì˜¤ë¥˜ë¡œ ì¸í•´ re-list ì‘ì—…ì„ í•´ì•¼í•  ë•Œ ë°œìƒëœë‹¤. ì•ì„œ ì •ë¦¬í–ˆë˜ ListAndWatch ì‘ì—…ì—ì„œì˜ Listë¼ê³  ë³´ë©´ ëœë‹¤.</p><p>ì´ì™€ ê°™ì€ ë‹¤ì–‘í•œ ë³€ê²½ íƒ€ì…ìœ¼ë¡œ ì¸í•´ OnUpdate ì´ë²¤íŠ¸ëŠ” ì§€ì†ì ìœ¼ë¡œ í˜¸ì¶œë˜ê³  ìˆëŠ” ê²ƒì´ë‹¤. ì§„ì§œ ë³€ê²½ì´ ì¼ì–´ë‚¬ì„ ê²½ìš°ì—ë§Œ ì²˜ë¦¬ë¥¼ í•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? ìš°ë¦° ì´ë¯¸ <code class="language-plaintext highlighter-rouge">resourceVersion</code>ì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì•ì„  ì •ë¦¬ë¥¼ í†µí•´ ì•Œê³  ìˆëŠ” ìƒíƒœì´ë‹¤. ë‹¹ì¥ ì‚¬ìš©í•´ë³´ì.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">UpdateFunc</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">oldObj</span><span class="p">,</span> <span class="n">newObj</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
  <span class="n">old</span> <span class="o">:=</span> <span class="n">oldObj</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">v1</span><span class="o">.</span><span class="n">Pod</span><span class="p">)</span>
  <span class="n">cur</span> <span class="o">:=</span> <span class="n">newObj</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">v1</span><span class="o">.</span><span class="n">Pod</span><span class="p">)</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Update: "</span> <span class="o">+</span> <span class="n">cur</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span> <span class="s">", old RV: "</span> <span class="o">+</span> <span class="n">old</span><span class="o">.</span><span class="n">ResourceVersion</span> <span class="o">+</span> <span class="s">", new RV: "</span> <span class="o">+</span> <span class="n">cur</span><span class="o">.</span><span class="n">ResourceVersion</span><span class="p">)</span>
<span class="p">},</span>
</pre></table></code></div></div><p>UpdateFuncì„ ì´ë ‡ê²Œ ë³€ê²½í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ë³´ì.</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>â¯ go run main.go
InformerFactory started
Add: nginx
Update: nginx, old RV: 2206, new RV: 2206
Update: nginx, old RV: 2206, new RV: 2206
Update: nginx, old RV: 2206, new RV: 2206
...
</pre></table></code></div></div><p>old/new resourceVersionì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. objectì— ëŒ€í•œ ë³€ê²½ì´ ì „í˜€ ì—†ëŠ”ë°ë„ OnUpdateì˜ ë™ì‘ìœ¼ë¡œ ì¸í•´ ê¾¸ì¤€íˆ í•¸ë“¤ë§ë˜ê³  ìˆë‹¤.</p><p>ì´ì œ nginx podì— ë³€ê²½ì„ ê°€í•´ë³´ì. ê°„ë‹¨íˆ labelì„ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ í•´ë³´ê³ ì í•œë‹¤.</p><div class="language-shell nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>â¯ kubectl label pods nginx <span class="nv">foo</span><span class="o">=</span>bar
pod/nginx labeled
<span class="nt">---</span>
Update: nginx, old RV: 2206, new RV: 2451 &lt;- pod/nginx labeled
Update: nginx, old RV: 2451, new RV: 2451
Update: nginx, old RV: 2451, new RV: 2451
</pre></table></code></div></div><p>nginx podì— labelì´ ì¶”ê°€ë˜ê³  resourceVersion ë˜í•œ ë³€ê²½ë˜ì—ˆë‹¤. ì´ë ‡ë“¯ objectê°€ ì˜ì†í™”ë˜ëŠ” ì‹œì ì˜ ìƒíƒœë¥¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” resourceVersionì„ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ ë³€ê²½ ê°ì§€ì— ëŒ€í•œ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.</p><h2 id="informers-architecture"><span class="mr-2">Informerâ€™s Architecture</span><a href="#informers-architecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>ì´ì œ Informerê°€ ì–´ë–¤ í˜•íƒœë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€ ì‚´í´ë³´ë„ë¡ í•˜ì. Kubernetes ì†ŒìŠ¤ ì½”ë“œì— ë”°ë¥¸ Informerë¥¼ í†µí•œ watch event ì „ë‹¬ ë°©ì‹ì€ ê·¸ë¦¼ 1.ê³¼ ê°™ë‹¤.</p><p><img data-src="/images/informer-architecture.png" alt="informer-architecture" data-proofer-ignore> <em>ê·¸ë¦¼ 1. Informerê°€ watch eventë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹</em></p><p>í•˜ë‚˜ì˜ SharedInformerëŠ” íŠ¹ì • API Group ë° kind/resourceì˜ objectì— ëŒ€í•œ ì—°ê²°ì„ ì œê³µí•œë‹¤. objectëŠ” API Group, kind/resource, namespace ë° nameìœ¼ë¡œ ì‹ë³„ëœë‹¤.</p><p>SharedInformerë¥¼ ê¸°ë°˜ìœ¼ë¡œ Indexer ì¶”ê°€ ë° ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” SharedIndexInformerë¥¼ ì‚´í´ë³´ì. (informers.NewSharedInformer()ë¥¼ í˜¸ì¶œí•˜ë©´ NewSharedIndexInformerë¥¼ ë°˜í™˜í•œë‹¤.) SharedIndexInformerëŠ” ì£¼ìš” ì»´í¬ë„ŒíŠ¸ì¸ Indexer, Controller, SharedProcessorë¥¼ í™•ì¸í•˜ê³  ë„˜ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤.</p><dl><dt>Indexer<dd>IndexerëŠ” ì¸ë±ì‹±ëœ ë¡œì»¬ ìºì‹œì´ë‹¤. objectë¥¼ ì €ì¥í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì¸ Storeë¥¼ ì—¬ëŸ¬ ì¸ë±ìŠ¤ë¡œ í™•ì¥í•˜ë©° DeltaFIFOì—ê²ŒëŠ” KnownObjects ì—­í• ì„ í•˜ë©° objectë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©ë˜ëŠ” Keyì˜ ëª©ë¡ì„ ì œê³µí•´ì¤€ë‹¤. ë˜í•œ í´ë¼ì´ì–¸íŠ¸ê°€ Listerë¥¼ í†µí•´ List/Get ìš”ì²­ì„ í•˜ë©´ ìºì‹±ëœ ë°ì´í„°ë¥¼ ì „ë‹¬í•´ì¤€ë‹¤.<dt>Controller<dd>ControllerëŠ” ì‹¤í–‰ë  ë•Œ ì§€ì •ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ê°ì‹œí•˜ê³  ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ì§€ì •ëœ Storeì— ì €ì¥ë˜ë„ë¡ í•˜ëŠ” Reflectorë¥¼ ìƒì„±í•˜ë©´ì„œ ê°ì‹œ ì‘ì—…ì— ListerWatcherë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤. ListerWatcherëŠ” object/notificationë“¤ì„ ê°€ì ¸ì˜¤ê³  ì´ë¥¼ DeltaFIFOë¡œ pushí•˜ëŠ” ë™ì‹œì— í•´ë‹¹ FIFOì—ì„œ popí•˜ì—¬ HandleDeltasë¡œ Deltaë¥¼ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì´ë©° ê° Deltaì— ëŒ€í•´ Indexerë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ê´€ë ¨ ì•Œë¦¼ì„ sharedProcessorì— ì±„ìš´ë‹¤.<dt>SharedProcessor<dd>Informerì˜ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸(Listenerë¥¼ í†µí•´)ì— í•´ë‹¹ ì•Œë¦¼ì„ ì „ë‹¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ResourceEventHandlerë¥¼ ì¶”ê°€í•˜ë©´ SharedProcessorì˜ Listenerì— ì¶”ê°€ê°€ ë˜ì–´ ì•Œë¦¼ì„ ì§€ì†ì ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.</dl><p>ì—¬ê¸°ì—ì„œ DeltaFIFOëŠ” ì£¼ì–´ì§„ ê°ì²´ì˜ ë³€ê²½ ì‚¬í•­ë“¤ì— ëŒ€í•œ Deltaë¥¼ í•­ëª©ìœ¼ë¡œ ë‹¤ë£¨ëŠ” Queueì´ë‹¤. Informerê°€ ì‹¤í–‰ë  ë•Œ ìƒì„±ë˜ë©° Pop(), Get(), GetByKey(), List()ì™€ ê°™ì€ methodë“¤ì„ ì œê³µí•œë‹¤.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>InforemrëŠ” íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•œ ìˆ˜ë§ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì¡´ì¬í•˜ë”ë¼ë„ í•˜ë‚˜ì˜ watch connectionìœ¼ë¡œ ì²˜ë¦¬ë  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤. ë³€ê²½ ê°ì§€ê°€ í•„ìš”í•œ í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¨ì§€ ResourceEventHandlerë¥¼ ì¶”ê°€í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤. ë˜í•œ Indexerì— ìºì‹±ëœ ë°ì´í„°ë¥¼ Listerë¥¼ í†µí•´ì„œ ì ‘ê·¼í•´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p><p>ê·¸ë¦¬ê³  InformerëŠ” watch connectionì´ ëŠì–´ì§€ë©´ WatchErrorHandlerë¥¼ í˜¸ì¶œí•œ í›„ Backoff í•œë‹¤. ë§Œì•½ ì¤‘ë‹¨ëœ ê¸°ê°„ì´ ê¸¸ì–´ì ¸ì„œ etcdê°€ eventë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚­ì œë¥¼ í•´ eventê°€ ì†ì‹¤ë˜ëŠ” ê²½ìš°, InformerëŠ” ëª¨ë“  objectë¥¼ ë‹¤ì‹œ ë‚˜ì—´(re-list)í•œë‹¤.</p><div class="language-go nolineno highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">func</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">Reflector</span><span class="p">)</span> <span class="n">Run</span><span class="p">(</span><span class="n">stopCh</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="k">struct</span><span class="p">{})</span> <span class="p">{</span>
  <span class="n">klog</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"Starting reflector %s (%s) from %s"</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">expectedTypeName</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">resyncPeriod</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
  <span class="n">wait</span><span class="o">.</span><span class="n">BackoffUntil</span><span class="p">(</span><span class="k">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">r</span><span class="o">.</span><span class="n">ListAndWatch</span><span class="p">(</span><span class="n">stopCh</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="n">r</span><span class="o">.</span><span class="n">watchErrorHandler</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="n">r</span><span class="o">.</span><span class="n">backoffManager</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="n">stopCh</span><span class="p">)</span>
  <span class="n">klog</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="o">.</span><span class="n">Infof</span><span class="p">(</span><span class="s">"Stopping reflector %s (%s) from %s"</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">expectedTypeName</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">resyncPeriod</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>í´ë¼ì´ì–¸íŠ¸ê°€ Informerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  Watch() verbë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´ ì´ëŸ¬í•œ ì‘ì—…ë“¤ì„ ì§ì ‘í•´ì•¼ë§Œ í•˜ê±°ë‚˜, ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ eventë¥¼ ë†“ì¹˜ê²Œ ë  ê²ƒì´ë‹¤.</p><p>ì´ëŸ¬í•œ ì´ìœ ë“¤ë¡œ Informerì˜ ì‚¬ìš©ì´ ê¶Œì¥ë˜ê³  ìˆë‹¤. ì´ì œ ë§ˆì§€ë§‰ìœ¼ë¡œ Kubernetesì˜ Eventì— ëŒ€í•´ íŒŒì•…í•´ë³´ì.</p><div style="text-align: center; font-weight: bold; margin-top: 100px; margin-bottom: 50px">ë.</div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/watch/" class="post-tag no-text-decoration" >watch</a> <a href="/tags/event/" class="post-tag no-text-decoration" >event</a> <a href="/tags/apiserver/" class="post-tag no-text-decoration" >apiserver</a> <a href="/tags/gorestful/" class="post-tag no-text-decoration" >gorestful</a> <a href="/tags/informer/" class="post-tag no-text-decoration" >informer</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Informer%EC%9D%98+%EA%B5%AC%EC%A1%B0+-+wq.lee&url=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fwhat-is-a-kubernetes-watch-event-3rd%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Informer%EC%9D%98+%EA%B5%AC%EC%A1%B0+-+wq.lee&u=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fwhat-is-a-kubernetes-watch-event-3rd%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fwhat-is-a-kubernetes-watch-event-3rd%2F&text=Informer%EC%9D%98+%EA%B5%AC%EC%A1%B0+-+wq.lee" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fblog.wqlee.com%2Fposts%2Fwhat-is-a-kubernetes-watch-event-3rd%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/cgroups-and-kubernetes/">Control groups & Kubernetes</a><li><a href="/posts/what-is-a-kubernetes-watch-event-4rd/">Eventë€ê±´ ì–´ì©Œë©´ ì–´ë ¤ìš´ê²Œ ì•„ë‹ê¹Œ</a><li><a href="/posts/scheduling-in-go-01/">Scheduling In Go I - OS Scheduler</a><li><a href="/posts/what-is-a-kubernetes-watch-event-3rd/">Informerì˜ êµ¬ì¡°</a><li><a href="/posts/what-is-a-kubernetes-watch-event-2nd/">Watch Serverì— ìš”ì²­ì´ ë„ë‹¬í•˜ê¸°ê¹Œì§€ì˜ ê³¼ì •</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/event/">event</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/watch/">watch</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/apiserver/">apiserver</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/gorestful/">gorestful</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/scheduler/">scheduler</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/what-is-a-kubernetes-watch-event-2nd/"><div class="card-body"> <em class="timeago small" data-ts="1640962800" > 2022-01-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Watch Serverì— ìš”ì²­ì´ ë„ë‹¬í•˜ê¸°ê¹Œì§€ì˜ ê³¼ì •</h3><div class="text-muted small"><p> ì•ì„œ í´ë¼ì´ì–¸íŠ¸ì™€ API serverê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ Watch eventë¥¼ ìš”ì²­í•˜ê³  ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸í•´ë´¤ë‹¤. ì´ë²ˆì—ëŠ” ì¢€ ë” ê¹Šê²Œ ë“¤ì–´ê°€ì„œ API serverê°€ Watch eventì— ëŒ€í•œ ì‘ë‹µì„ í•˜ê¸° ìœ„í•´ ì–´ë–¤ ì¤€ë¹„ë¥¼ í•˜ëŠ”ì§€, Watch Server ìƒì„±ê¹Œì§€ì˜ êµ¬í˜„ ë¶€ë¶„ì„ ì•Œì•„ë³¼ ì°¨ë¡€ì´ë‹¤. ë¶„ì„í•˜ëŠ” ì™€ì¤‘ì— ì •ë§ ë§ì€ ìš©ì–´ë“¤ì´ ë“±ì¥í–ˆëŠ”ë° ë‚´ë¶€ì ìœ¼ë¡œ ...</p></div></div></a></div><div class="card"> <a href="/posts/basic-etcd/"><div class="card-body"> <em class="timeago small" data-ts="1642600800" > 2022-01-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basic ETCD</h3><div class="text-muted small"><p> Highly Available Fully Replicated Strong consistency model Scalable watch mechanism Concurrency control primitives Distributed Key/Value store Distributed consensus is a fancy way to e...</p></div></div></a></div><div class="card"> <a href="/posts/what-is-a-kubernetes-watch-event-4rd/"><div class="card-body"> <em class="timeago small" data-ts="1643454000" > 2022-01-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Eventë€ê±´ ì–´ì©Œë©´ ì–´ë ¤ìš´ê²Œ ì•„ë‹ê¹Œ</h3><div class="text-muted small"><p> Kubernetes Architecture KubernetesëŠ” microservice ê¸°ë°˜ì˜ ì•„í‚¤í…ì²˜ê°€ ì ìš©ë˜ì–´ ìˆë‹¤. Control Plane, Worker Nodeì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì€ ê°œë³„ ì„œë¹„ìŠ¤ë¡œ êµ¬í˜„ëœë‹¤. íŠ¹íˆ Control Planeì€ Eventì™€ í•¨ê»˜ ëŠìŠ¨í•˜ê²Œ ê²°í•©ëœ êµ¬ì„± ìš”ì†Œì˜ ì›ì¹™ì„ ë§ì´ ì ‘ëª©ì‹œì¼œ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ì´ëŸ¬í•œ ì•„í‚¤í…ì²˜ì˜ ì£¼ìš” ì´...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/what-is-a-kubernetes-watch-event-2nd/" class="btn btn-outline-primary" prompt="Older"><p>Watch Serverì— ìš”ì²­ì´ ë„ë‹¬í•˜ê¸°ê¹Œì§€ì˜ ê³¼ì •</p></a> <a href="/posts/basic-etcd/" class="btn btn-outline-primary" prompt="Newer"><p>Basic ETCD</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2022 <a href="https://www.linkedin.com/in/wq-lee">Wongyu Lee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/event/">event</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/watch/">watch</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/apiserver/">apiserver</a> <a class="post-tag" href="/tags/go/">go</a> <a class="post-tag" href="/tags/gorestful/">gorestful</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/scheduler/">scheduler</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4PS0JXVL1J"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4PS0JXVL1J'); }); </script>
